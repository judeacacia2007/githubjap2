import requests
import sqlite3
from datetime import datetime

def create_table():
    conn = sqlite3.connect("weather.db")
    cursor = conn.cursor()
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS weather_logger(
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            city TEXT,
            temperature REAL,
            description TEXT,
            datetime TEXT
        )
''' )
    conn.commit()
    conn.close()
def fetch_weather(city):
    api_key = "https://wttr.in/{}?format=j1".format(city)
    response = requests.get(api_key)
    date = response.json()

    temperature = date['current_condition'][0]['temp_C']
    description = date['current_condition'][0]['weatherDesc'][0]['value']
    return float(temperature),description

def save_weather(city,temp,desc):
    conn = sqlite3.connect("weather.db")
    cursor = conn.cursor()
    dt = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    cursor = conn.execute("INSERT INTO weather_logger(city,temperature,description,datetime)VALUES(?,?,?,?)",(city,temperature,description,dt))
    conn.commit()
    conn.close()

def view_history():
    conn = sqlite3.connect("weather.db")
    cursor = conn.cursor()
    cursor.execute("SELECT*FROM weather_logger ORDER BY id DESC LIMIT 1")
    rows = cursor.fetchall()
    for row in rows:
        print(row)
    conn.close()

create_table()
city = input("enter city name:")
temperature, description = fetch_weather(city)
print(f"current temp:{temperature}),condition:{description}")
save_weather(city,temperature,description)
print("\nweather history:")
view_history()

